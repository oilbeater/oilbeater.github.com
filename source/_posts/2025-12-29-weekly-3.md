---
title: 周报 3 —— 痔疮上身
date: "2025-12-29 08:25"
created: ["2025-12-29"]
tags:
- opensource
- documents
---

## 痔疮

居家办公三周后莫名其妙的得了痔疮，前几天都只能躺着了。查了下资料说现代人可能是因为长时间坐马桶导致的，可是我并没有。稍微好一些之后发现只要坐平时办工坐的椅子就会疼，仔细观察发现这个椅子由于长时间胶皮老化中间凹下去了，所以做起来就类似一个马桶两边高中间低，换成个平板椅子就好多了。

## 技术

对着上周看的 [Performance Hints](https://abseil.io/fast/hints.html) 里的一条[unnecessarily-nested-maps](https://abseil.io/fast/hints.html#unnecessarily-nested-maps)，拿着锤子找钉子，去 Prometheus 里看看有没有什么蹭 PR 的机会。最终发现这个优化方法还是有很多细节要考虑的，并不是完全没有副作用，尤其在 Prometheus 的场景里有时候完全不适用还会导致性能严重下降，之后可能会单写一个博客来说明。不过好在 Prometheus 里还有一处是完美适合这个优化的，提交了一个 PR [perf(promql): update matchedSigs to a flat map reduce memory by 97% for GROUP_LEFT](https://github.com/prometheus/prometheus/pull/17732)，能优化一个常见场景 13% 的 CPU 和 97% 的内存分配。

看了[How uv got so fast](https://nesbitt.io/2025/12/26/how-uv-got-so-fast.html)，和第一直觉认为的 Rust 比 Python 快，所以 uv 才能这么快不同，uv 的快主要还是来自实现架构层面的选择。一方面是 Python 的包管理出了更高效的标准，另一方面 uv 选择放弃了大量的历史兼容性，专注于标准路径的优化。此外还有很多语言无关的优化，比如并行下载，硬链接等等其实是其他语言的依赖管理都有的功能，只是 pip 的历史包袱太大了，一直都没有这方面的优化。

在逛 Prometheus Issues 是发现一个 [WIP: tsdb: persist series metadata to Parquet files](https://github.com/prometheus/prometheus/pull/17734) 需要找时间看一下 Parquet 是个什么存储。

## 生活

周末和孩子去了[城市农场](https://j.map.baidu.com/5c/3FQk)，一开始以为是个什么网红景点，去了后发现是个正经的科研机构，中国奶牛的育种就是从这里开始的。里面都是些看上去六七十年代的老房子，有科研人员专门负责讲解，体验还是很不错的。另一方面想到自己小时候没有盒装奶还都是牧场每天早上和报纸一块送的鲜牛奶要拿回家去煮。

里面有从刚出生到三四岁的奶牛，可以自己去喂，小孩抱着草料来回跑喂了快一个小时。

![](../images/585200c8615451436d3d3387ab65f7591.jpg)

## 娱乐

- 打仗就是修路 [【不懂地理打不了仗】3D地形全面复盘蜀汉立国之战——汉中之战！](https://www.bilibili.com/video/BV1qwBWBXE32/?spm_id_from=333.1391.0.0) 
- 可汗的充电视频 [赠予沙阿（上） 伊朗·1951](https://www.bilibili.com/video/BV1oMBUBREK8/?spm_id_from=333.1391.0.0)